---
title: "Поиграемся с HTML5 history API"
tags: "historyAPI,html5,javascript,Хочу сделать мир лучше"
date: "2012-08-12"
---

<script type="text/javascript">// <![CDATA[ function playHistory(count) { var string = location.pathname + location.search; var i = 0; var state = ''; function draw(){ if(i == string.length){ state ='';i = 0; count--; } if(!count){ return false; } state = state + string[i]; i++; history.pushState({}, '', state); setTimeout(draw, 100); } draw(); } // ]]></script>

 Никакой военной тайны в статье не открою, но открою глаза для тех, кто не работал с **history API**. Чтобы понять нужно вам или нет, просто кликните сюда и понаблюдайте за адресной стройкой браузера. Если эта возможность не удивила - можете дальше не читать статью. (Прошу обратить внимание: мы меняем содержание адресной строки без перезагрузки страницы, это важно)

Ну а для тех, кто дошел до этого места, попробуем разобрать магию: мы работаем с объектом window.history с помощью javascript. Почитать подробно можно [тут](https://dev.w3.org/html5/spec/history.html). Разбирать очевидные методы типа: go(), back(), forward() мы не будем. Остановимся более подробно на `pushState(data, title, url)`, где

- data - это данные передаваемые странице(можно пустой объект)
- title - название конкретного состояния(тоже можно оставить пустым)
- url - то что мы хотим записать сразу после домена

Вот пример с конкретными данными:

history.pushState({}, '', '/someurl/that/you/want/to/see/in/location')

Как видите  - ничего сложного.

Где это необходимо использовать? В сервисах, где большая часть логики на стороне клиента, а обращения к серверу идут аяксом: при этом хотелось держать в браузере [валидную](javascript:return false; "т.е. чтобы правильно отрабатывали кнопочки back и forward") историю переходов.

На всякий случай проверяем [табличку совместимости](https://caniuse.com/#search=history) с вашими поддерживаемыми браузерами.

Вот полный код того, что происходило вначале: https://learn.javascript.ru/play/S60sJ (в песочнице работать не будет, так как она открывается во фрейме)
